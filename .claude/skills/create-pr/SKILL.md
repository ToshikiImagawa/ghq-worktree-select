---
name: create-pr
description: プルリクエスト作成を支援するスキル。コミット履歴とdiffから自動的にPRタイトルと本文を生成し、PRテンプレートがあれば利用する。ユーザーが「PRを作成して」「プルリクエストを作って」と依頼した場合、またはコード変更後にPRが必要な場合に使用する。
---

# Create PR

プルリクエスト作成を支援するスキル。

## 概要

このスキルは、現在のブランチの変更内容からプルリクエストを作成する。コミット履歴とdiffを分析し、適切なPRタイトルと本文を自動生成する。PRテンプレートが存在する場合は、それに従ってフォーマットする。

## 使用タイミング

- ユーザーが「PRを作成して」「プルリクエストを作って」と依頼した場合
- コード変更が完了し、レビューの準備ができた場合
- フィーチャーブランチをメインブランチにマージする準備ができた場合

## ワークフロー

### 1. 現在の状態を確認

まず、git statusとブランチ情報を確認する。

```bash
git status
git branch --show-current
git log origin/main..HEAD --oneline
```

- コミットされていない変更がある場合は、先にコミットするか確認する
- 現在のブランチがmain/masterでないことを確認する

### 2. PRテンプレートを確認

PRテンプレートが存在するかチェックする。

```bash
# PRテンプレートの候補
ls .github/pull_request_template.md 2>/dev/null
ls .github/PULL_REQUEST_TEMPLATE.md 2>/dev/null
ls docs/pull_request_template.md 2>/dev/null
```

テンプレートが存在する場合は、それを読み込んで使用する。

### 3. 変更内容を分析

ベースブランチ（通常はmain）との差分を確認する。

```bash
# コミット履歴を確認
git log origin/main..HEAD --oneline --no-merges

# 変更されたファイルを確認
git diff origin/main...HEAD --name-only

# 詳細なdiffを確認
git diff origin/main...HEAD
```

### 4. PRタイトルと本文を生成

#### PRタイトルの生成規則

- 70文字以内に収める
- 変更の主要な目的を簡潔に表現する
- コミットメッセージのプレフィックスを活用する：
  - 新機能追加の場合: "feat: ..."
  - バグ修正の場合: "fix: ..."
  - ドキュメント更新の場合: "docs: ..."
  - リファクタリングの場合: "refactor: ..."

#### PR本文の生成

PRテンプレートがある場合は、それに従う。ない場合は以下の構造を使用する：

```markdown
## 概要
[変更の主要な目的を1-3文で説明]

## 変更内容
- [主要な変更点1]
- [主要な変更点2]
- [主要な変更点3]

## テストプラン
- [ ] [テスト項目1]
- [ ] [テスト項目2]

## 関連Issue
Closes #[issue番号] (該当する場合)

## スクリーンショット
(該当する場合、UIの変更など)

---
🤖 Generated with Claude Code
```

### 5. リモートへプッシュ

ローカルブランチがリモートにプッシュされていない、または最新でない場合は、プッシュする。

```bash
# リモートブランチの状態を確認
git status

# プッシュが必要な場合
git push -u origin <ブランチ名>
```

### 6. PRを作成

`gh` CLIを使用してPRを作成する。

```bash
gh pr create --title "PRタイトル" --body "$(cat <<'EOF'
PR本文の内容
EOF
)"
```

#### オプション

- `--base <ブランチ名>`: ベースブランチを指定（デフォルトはmain）
- `--draft`: ドラフトPRとして作成
- `--reviewer <ユーザー名>`: レビュアーを指定
- `--label <ラベル名>`: ラベルを追加

### 7. 確認とURL表示

作成されたPRのURLをユーザーに表示する。

```bash
gh pr view --web
```

## PRテンプレートの例

リポジトリに `.github/pull_request_template.md` を配置することで、PR作成時に自動的にテンプレートが適用される。

```markdown
## 概要
<!-- 変更の主要な目的を説明してください -->

## 変更内容
<!-- 主要な変更点をリストアップしてください -->
-

## テストプラン
<!-- テスト方法を記載してください -->
- [ ] ユニットテストを追加
- [ ] 手動テストを実施

## チェックリスト
- [ ] コードレビューの準備ができている
- [ ] ドキュメントを更新した（必要に応じて）
- [ ] テストを追加/更新した

## 関連Issue
<!-- 関連するIssueがあれば記載してください -->
Closes #
```

## 注意事項

- PRタイトルは簡潔に、本文で詳細を説明する
- 変更が多岐にわたる場合は、複数のPRに分割することを検討する
- ドラフトPRを活用し、早めにフィードバックを得る
- レビュアーの負担を考慮し、適切な粒度でPRを作成する
