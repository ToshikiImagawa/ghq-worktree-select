---
name: review-pr
description: プルリクエストの包括的なレビューを実施するスキル。コード品質、セキュリティ、ドキュメントの観点から変更内容を分析し、改善提案を提供する。ユーザーが「PRをレビューして」「プルリクエストをチェックして」と依頼した場合、またはPR番号やURLを提供した場合に使用する。
---

# Review PR

プルリクエストの包括的なレビューを実施するスキル。

## 概要

このスキルは、プルリクエストをコード品質、セキュリティ、ドキュメントの観点からレビューする。変更内容を分析し、潜在的な問題や改善点を特定して、建設的なフィードバックを提供する。

## 使用タイミング

- ユーザーが「PRをレビューして」「プルリクエストをチェックして」と依頼した場合
- PR番号やURLを提供された場合
- コードレビューの補助が必要な場合

## ワークフロー

### 1. PRの情報を取得

まず、レビュー対象のPRを特定し、基本情報を取得する。

```bash
# PR番号を指定してPR情報を取得
gh pr view <PR番号>

# PRのdiffを取得
gh pr diff <PR番号>

# PRの変更ファイル一覧を取得
gh pr view <PR番号> --json files --jq '.files[].path'
```

PR番号が指定されていない場合は、現在のブランチに関連するPRを検索する。

```bash
# 現在のブランチのPRを取得
gh pr view
```

### 2. 変更内容の分析

PRの変更内容を以下の観点から分析する。

#### 2.1 コード品質のレビュー

- **コーディング規約の遵守**: 既存のコードスタイルに従っているか
- **可読性**: コードが理解しやすいか、適切な命名がされているか
- **複雑度**: 関数やメソッドが適切なサイズか、責務が明確か
- **重複コード**: DRY原則に従っているか
- **エラーハンドリング**: 適切にエラーを処理しているか
- **ベストプラクティス**: 言語やフレームワークのベストプラクティスに従っているか

レビューのポイント:
```
✅ 良い例: 簡潔で明確な関数、適切な命名
❌ 改善が必要: 長すぎる関数、不明瞭な変数名、過度なネスト
```

#### 2.2 セキュリティレビュー

**OWASP Top 10**を参考に、以下の脆弱性をチェックする:

1. **インジェクション攻撃**
   - SQLインジェクション、コマンドインジェクション、XSS
   - ユーザー入力のサニタイゼーションとバリデーション

2. **認証とセッション管理**
   - 認証情報の適切な保存（パスワードのハッシュ化等）
   - セッション管理の脆弱性

3. **機密データの露出**
   - ハードコードされた認証情報やAPIキー
   - ログに含まれる機密情報

4. **アクセス制御の不備**
   - 権限チェックの漏れ
   - 不適切な認可処理

5. **その他のセキュリティ問題**
   - 安全でない依存関係
   - 不適切なエラーメッセージ（詳細すぎる情報の露出）

詳細なセキュリティチェックリストについては、[references/security-checklist.md](references/security-checklist.md)を参照。

#### 2.3 ドキュメントの確認

- **コメント**: 複雑なロジックに適切なコメントがあるか
- **README**: 新機能の追加に伴うドキュメント更新がされているか
- **API仕様**: APIの変更がある場合、ドキュメントが更新されているか
- **CHANGELOG**: 変更内容がCHANGELOG.mdに記録されているか（該当する場合）

### 3. レビューコメントの生成

分析結果に基づいて、建設的なレビューコメントを生成する。

#### レビューコメントの構造

```markdown
## レビュー結果

### ✅ 良い点
- [良い点1]
- [良い点2]

### ⚠️ 改善提案

#### コード品質
**ファイル名:行番号**
- 問題: [問題の説明]
- 提案: [改善案]
- 難易度: ★☆☆☆☆ (1-5)
- 有効度: ★★★★☆ (1-5)

#### セキュリティ
**ファイル名:行番号**
- 問題: [セキュリティ上の問題]
- リスク: [高/中/低]
- 提案: [対策方法]

#### ドキュメント
- 問題: [ドキュメントの不足や問題]
- 提案: [追加・修正すべき内容]

### 📝 その他のコメント
- [その他の気づきや質問]
```

### 4. レビュー結果の提示

生成されたレビューコメントをユーザーに提示する。

ユーザーがGitHub上にコメントを投稿したい場合は、`gh pr review`コマンドを使用する。

```bash
# レビューコメントを投稿
gh pr review <PR番号> --comment --body "レビューコメント"

# 変更リクエストとして投稿
gh pr review <PR番号> --request-changes --body "レビューコメント"

# 承認として投稿
gh pr review <PR番号> --approve --body "レビューコメント"
```

## レビューのベストプラクティス

### 建設的なフィードバック

- **具体的に**: 「良くない」ではなく、「なぜ良くないか」を説明する
- **代替案を提示**: 問題を指摘するだけでなく、改善案を提供する
- **優先度を明示**: すべての指摘が同等ではないことを示す
- **肯定的な姿勢**: 良い点も積極的に評価する

### レビューの粒度

- **クリティカルな問題**: セキュリティ、重大なバグ → 必ず修正
- **重要な改善**: パフォーマンス、保守性の向上 → 強く推奨
- **マイナーな提案**: スタイルの統一、小さなリファクタリング → 任意

## 注意事項

- レビューは建設的で、協力的な姿勢で行う
- コードの作者を尊重し、攻撃的な表現は避ける
- すべての指摘に対して具体的な理由と改善案を提供する
- 自動化できる問題（フォーマット等）は、linterやフォーマッターの導入を提案する
